---
import { getCollection } from "astro:content";
import { useTranslations } from "../i18n/utils";

const { currentLang = 'en' } = Astro.props;
const t = useTranslations(currentLang);

const allReasons = await getCollection("reasons");
const reasons = allReasons.sort(
  (a: { data: { sortOrder?: number } }, b: { data: { sortOrder?: number } }) =>
    (a.data.sortOrder || 999) - (b.data.sortOrder || 999)
);

// Icon mapping based on sortOrder or title
const iconMap: { [key: number]: string } = {
  1: 'M13 10V3L4 14h7v7l9-11h-7z', // Lightning bolt
  2: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z', // Shield
  3: 'M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5', // Target/Layers
  4: 'M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z M9 12l2 2 4-4', // Clock
  5: 'M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2 M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z M22 21v-2a4 4 0 0 0-3-3.87 M16 3.13a4 4 0 0 1 0 7.75', // Trending up
  6: 'M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2 M9 11a4 4 0 1 0 0-8 4 4 0 0 0 0 8z M23 11a2 2 0 1 1-4 0 2 2 0 0 1 4 0z', // Users
};
---

<section id="reasons" class="w-full py-16 px-4 relative overflow-hidden">
  <div class="max-w-11/12 mx-auto relative z-10">
    <h2 class="text-5xl font-extrabold mb-8 text-center text-white">
      ¿Por qué elegir <span class="text-(--color-primary)">Logic <span class="text-white">&</span> Lines</span>?
    </h2>
    <p class="text-center text-gray-300 text-xl mb-24 max-w-6xl mx-auto">
      Combinamos experiencia técnica con un enfoque centrado en resultados empresariales
    </p>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 max-w-6xl mx-auto">
      {
        reasons.map((reason, index) => {
          const { data } = reason;
          const title = currentLang === 'es' && data.title_es ? data.title_es : data.title;
          const description = currentLang === 'es' && data.description_es ? data.description_es : data.description;
          const iconPath = iconMap[data.sortOrder] || iconMap[1];
          
          return (
          <div class="benefit-card group relative bg-transparent hover:bg-(--color-bg-alt) rounded-xl p-6 border border-[#F59E0B]/30 md:border-transparent hover:border-[#F59E0B] transition-all duration-300 hover:shadow-xl hover:shadow-[#F59E0B]/10">
              <!-- Icon and Title Row -->
              <div class="flex items-start gap-4 mb-3">
                <!-- add "icon-box" to target on touch -->
                <div class="icon-box w-12 h-12 flex-shrink-0 flex items-center justify-center rounded-full bg-(--color-bg-alt) border border-[#F59E0B]/30 group-hover:border-[#F59E0B] group-hover:bg-[#F59E0B]/10 transition-colors duration-300">
                  <svg 
                    class="w-6 h-6 text-[#F59E0B]" 
                    fill="none" 
                    stroke="currentColor" 
                    stroke-width="2" 
                    stroke-linecap="round" 
                    stroke-linejoin="round"
                    viewBox="0 0 24 24"
                  >
                    <path d={iconPath}></path>
                  </svg>
                </div>
                
                <!-- Title -->
                <h3 class="text-xl font-bold text-white group-hover:text-[#F59E0B] transition-colors duration-300 pt-2" >
                  {title}
                </h3>
              </div>
              
              <!-- Description -->
              <p class="text-(--color-text-dark) text-sm leading-relaxed pl-16">
                {description}
              </p>
            </div>
          );
        })
      }
    </div>
  </div>
</section>

<!-- simulate hover on touch devices -->
<script is:inline>
  // Add "touch-hover" on touchstart and remove on touch end/cancel/leave
  const cards = document.querySelectorAll('.benefit-card');
  cards.forEach((card) => {
    const remove = () => card.classList.remove('touch-hover');

    card.addEventListener('pointerdown', (e) => {
      if (e.pointerType === 'touch') {
        card.classList.add('touch-hover');
      }
    });
    card.addEventListener('pointerup', remove);
    card.addEventListener('pointercancel', remove);
    card.addEventListener('mouseleave', remove);
  });
</script>

<style>
  #benefits {
    background-color: var(--color-bg);
  }
  
  .benefit-card {
    position: relative;
  }
  
  /* touch-hover: replicate hover visuals on touch devices */
  .benefit-card.touch-hover {
    border-color: #F59E0B;
    background-color: var(--color-bg-alt);
    box-shadow: 0 10px 25px rgba(245, 158, 11, 0.1);
  }
  .group.touch-hover h3 {
    color: #F59E0B;
  }
  .group.touch-hover .icon-box {
    border-color: #F59E0B;
    background-color: rgba(245, 158, 11, 0.1);
  }
</style>